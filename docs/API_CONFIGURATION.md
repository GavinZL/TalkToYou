# API配置指南

本文档详细说明如何配置千问API以使用TalkToYou应用。

## 获取千问API密钥

### 步骤1：注册阿里云账号

1. 访问 [阿里云官网](https://www.aliyun.com/)
2. 点击"免费注册"
3. 按照提示完成注册流程
4. 完成实名认证（可能需要）

### 步骤2：开通DashScope服务

1. 访问 [DashScope控制台](https://dashscope.aliyun.com/)
2. 使用阿里云账号登录
3. 同意服务协议并开通服务
4. 根据需要选择付费方案或使用免费额度

### 步骤3：创建API-KEY

1. 在DashScope控制台，进入"API-KEY管理"页面
2. 点击"创建新的API-KEY"
3. 输入API-KEY名称（如"TalkToYou"）
4. 点击"确定"生成密钥
5. **重要**：立即复制并保存密钥，密钥只显示一次

## 配置应用

### 在应用中配置API

1. 打开TalkToYou应用
2. 切换到"设置"标签
3. 在"API配置"部分填写以下信息：

#### API密钥
- 粘贴在DashScope获取的API-KEY
- 格式类似：`sk-xxxxxxxxxxxxxxxxxxxx`

#### API地址（默认可不修改）
```
https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
```

#### 模型版本
推荐选项：
- `qwen-turbo` - 速度快，成本低（推荐）
- `qwen-plus` - 效果好，成本中等
- `qwen-max` - 效果最好，成本高

4. 点击"保存"按钮

## API请求示例

应用会按以下格式调用千问API：

```json
{
  "model": "qwen-turbo",
  "input": {
    "messages": [
      {
        "role": "system",
        "content": "你是一个友好的AI助手"
      },
      {
        "role": "user",
        "content": "你好"
      }
    ]
  },
  "parameters": {
    "result_format": "message",
    "max_tokens": 2000,
    "temperature": 0.8
  }
}
```

## 费用说明

### 免费额度
- 新用户通常有一定的免费调用额度
- 具体额度请查看DashScope控制台

### 计费方式
- 按Token数量计费
- 不同模型价格不同
- qwen-turbo < qwen-plus < qwen-max

### 费用优化建议
1. 使用qwen-turbo模型降低成本
2. 减少上下文轮数（设置中的"上下文轮数"）
3. 降低最大tokens设置
4. 监控API使用情况

## 常见问题

### Q1: API调用失败，提示"认证失败"
**A:** 检查以下几点：
- API密钥是否正确复制
- 是否包含多余的空格
- 密钥是否已过期或被删除
- 是否在正确的地区使用服务

### Q2: API调用失败，提示"配额不足"
**A:** 原因可能是：
- 免费额度已用完
- 账户余额不足
- 请在DashScope控制台充值或升级套餐

### Q3: 如何查看API使用情况？
**A:** 
1. 登录DashScope控制台
2. 查看"用量统计"页面
3. 可以看到详细的调用次数和Token消耗

### Q4: 响应速度慢怎么办？
**A:** 
1. 尝试切换到qwen-turbo模型
2. 减少max_tokens设置
3. 检查网络连接质量
4. 高峰期可能响应较慢

### Q5: 是否支持其他大模型？
**A:** 
- 当前版本仅支持千问系列模型
- 未来版本计划支持更多模型
- 可以通过修改API地址和请求格式来适配其他兼容的模型

## 安全建议

### API密钥安全
1. ✅ **不要**将API密钥硬编码在代码中
2. ✅ **不要**将API密钥提交到代码仓库
3. ✅ 定期轮换API密钥
4. ✅ 为不同应用使用不同的API密钥
5. ✅ 如发现泄露立即在控制台删除密钥

### 应用使用的安全措施
- API密钥存储在iOS Keychain中
- 使用HTTPS加密传输
- 密钥仅在设备本地存储
- 不会上传到任何服务器

## 进阶配置

### 调整生成参数

#### 温度（Temperature）
- 范围：0.7 - 1.0
- 越低越保守，越高越有创造性
- 推荐：0.8

#### 最大Tokens
- 范围：500 - 4000
- 控制单次回复的最大长度
- 推荐：2000

#### 上下文轮数
- 范围：5 - 20轮
- 保留的对话历史数量
- 越多消耗的Token越多
- 推荐：10轮

### 自定义角色

在"角色设定"中可以自定义AI的性格：

**示例1：专业助手**
```
角色描述：你是一个专业的工作助手，回答简洁准确，注重效率。
```

**示例2：幽默伙伴**
```
角色描述：你是一个幽默风趣的聊天伙伴，喜欢用轻松的语气交流，偶尔开玩笑。
```

**示例3：学习导师**
```
角色描述：你是一个耐心的学习导师，擅长用简单易懂的方式解释复杂概念，鼓励学生思考。
```

## 技术支持

如遇到API配置问题：

1. 查阅 [DashScope官方文档](https://help.aliyun.com/zh/dashscope/)
2. 访问 [开发者社区](https://developer.aliyun.com/ask)
3. 在项目GitHub仓库提Issue

---

**最后更新**: 2025-01-01
